import{p as me,aC as pe,aD as ve,g as ge,u as Ve,aE as be,aF as fe,c as ye,f as ke,aG as xe,aH as Y,h as l,i as Z,K as Ce,r as n,P as W,Q as X,R as he,T as t,ah as ee,a3 as Pe,V,$ as b,aa as $,aI as we,a0 as Be,Z as ue,a2 as K,S as Ue,U as _e,a6 as ae,J as le,a8 as te,Y as s,ad as oe,a1 as se,a9 as Fe,a7 as Ae}from"./index-c505dd87.js";import{c as Se,a as H,e as re,f as Me,u as Re,d as w,V as Ie}from"./index.esm-67307f81.js";import{V as De}from"./VContainer-c8701468.js";import{a as $e,V as G}from"./VRow-b1561833.js";import{V as Te}from"./VDataTableServer-928c448d.js";import{m as qe,a as ne,V as Le}from"./VSelect-0794fc4f.js";import{V as Ee}from"./VTextarea-fc1ff1a8.js";import"./VDataTable-efd7bdf6.js";import"./VDivider-f3bbd198.js";import"./VList-97a9c3f1.js";import"./VChip-3e16e44a.js";const Ne=me({...pe(),...ve(qe(),["inline"])},"VCheckbox"),je=ge()({name:"VCheckbox",inheritAttrs:!1,props:Ne(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,f){let{attrs:v,slots:B}=f;const i=Ve(d,"modelValue"),{isFocused:y,focus:u,blur:U}=be(d),_=fe(),F=ye(()=>d.id||`checkbox-${_}`);return ke(()=>{const[T,A]=xe(v),q=Y.filterProps(d),L=ne.filterProps(d);return l(Y,Z({class:["v-checkbox",d.class]},T,q,{modelValue:i.value,"onUpdate:modelValue":g=>i.value=g,id:F.value,focused:y.value,style:d.style}),{...B,default:g=>{let{id:E,messagesId:m,isDisabled:k,isReadonly:x}=g;return l(ne,Z(L,{id:E.value,"aria-describedby":m.value,disabled:k.value,readonly:x.value},A,{modelValue:i.value,"onUpdate:modelValue":C=>i.value=C,onFocus:u,onBlur:U}),B)}})}),{}}}),ze={style:{height:"100%"},class:"bg-back"},Ke=ue("h2",{class:"text-center mt-10 text-primary"},"商品列表",-1),He={class:"text-grey-darken-3 font-weight-bold"},ta={__name:"ProductsView",setup(d){const{apiAuth:f}=Pe(),v=Ce(),B=n(null),i=n(!1),y=n(!1),u=n(""),U=["成蟲","幼蟲","標本","其他"],_=o=>{o?(u.value=o._id,m.value.value=o.name,k.value.value=o.price,x.value.value=o.stock,C.value.value=o.description,S.value.value=o.category,M.value.value=o.sell):u.value="",i.value=!0},F=()=>{i.value=!1,E(),B.value.deleteFileRecord()},T=o=>{u.value=o._id,m.value.value=o.name,y.value=!0},A=()=>{y.value=!1},q=Se({name:H().required("缺少商品名稱"),price:re().typeError("價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),stock:re().typeError("數量格式錯誤").required("缺少商品數量").min(0,"商品數量不能小於 0"),description:H().required("缺少商品描述"),category:H().required("缺少商品分類").test("isCategory","商品分類錯誤",o=>U.includes(o)),sell:Me()}),{handleSubmit:L,isSubmitting:g,resetForm:E}=Re({validationSchema:q,initialValues:{name:"",price:0,stock:0,description:"",category:"",sell:!1}}),m=w("name"),k=w("price"),x=w("stock"),C=w("description"),S=w("category"),M=w("sell"),h=n([]),J=n([]),de=async()=>{var o,a;try{await f.delete("/products/"+u.value),v({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),A(),P()}catch(r){console.log(r);const c=((a=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";v({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},ie=L(async o=>{var a,r,c;if(!((a=h.value[0])!=null&&a.error)&&!(u.value===""&&h.value.length===0))try{const e=new FormData;for(const p in o)e.append(p,o[p]);h.value.length>0&&e.append("image",h.value[0].file),u.value===""?await f.post("/products",e):await f.patch("/products/"+u.value,e),v({text:u.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),F(),Q()}catch(e){console.log(e);const p=((c=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";v({text:p,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),N=n(10),R=n([{key:"createdAt",order:"desc"}]),I=n(1),j=n([]),ce=[{title:"圖片",sortable:!1,key:"image",align:"center"},{title:"品名",sortable:!0,key:"name"},{title:"價格",sortable:!0,key:"price"},{title:"分類",sortable:!0,key:"category"},{title:"庫存",sortable:!0,key:"stock"},{title:"上架",sortable:!0,key:"sell"},{title:"編輯",sortable:!1,key:"edit",align:"center"},{title:"刪除",sortable:!1,key:"remove",align:"center"}],z=n(!0),O=n(0),D=n(""),P=async()=>{var o,a,r,c;z.value=!0;try{const{data:e}=await f.get("/products/all",{params:{page:I.value,itemsPerPage:N.value,sortBy:((o=R.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((a=R.value[0])==null?void 0:a.order)==="asc"?1:-1,search:D.value}});j.value.splice(0,j.value.length,...e.result.data),O.value=e.result.total}catch(e){console.log(e);const p=((c=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";v({text:p,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}z.value=!1};P();const Q=()=>{I.value=1,P()};return(o,a)=>{const r=W("RouterLink"),c=W("VueFileAgent");return X(),he("div",ze,[l(De,null,{default:t(()=>[l($e,{class:"justify-center"},{default:t(()=>[l(G,{cols:"12",lg:"10"},{default:t(()=>[Ke]),_:1}),l(G,{cols:"12",lg:"10",class:"text-end"},{default:t(()=>[l(V,{"prepend-icon":"mdi-plus",color:"primary",rounded:"",onClick:a[0]||(a[0]=e=>_())},{default:t(()=>[b("新增商品")]),_:1})]),_:1}),l(G,{cols:"12",lg:"10"},{default:t(()=>[l(Te,{"items-per-page":N.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=e=>N.value=e),P],"sort-by":R.value,"onUpdate:sortBy":[a[3]||(a[3]=e=>R.value=e),P],page:I.value,"onUpdate:page":[a[4]||(a[4]=e=>I.value=e),P],items:j.value,headers:ce,search:D.value,"items-length":O.value,loading:z.value,class:"py-5 px-10 bg-back"},{top:t(()=>[l($,{label:"搜尋","prepend-inner-icon":"mdi-magnify",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),variant:"underlined",onKeydown:we(Q,["enter"])},null,8,["modelValue"])]),"item.image":t(({item:e})=>[l(r,{to:"/products/"+e._id},{default:t(()=>[l(Be,{src:e.image,height:"100px",contain:""},null,8,["src"])]),_:2},1032,["to"])]),"item.name":t(({item:e})=>[l(r,{to:"/products/"+e._id,class:"text-decoration-none"},{default:t(()=>[ue("p",He,K(e.name),1)]),_:2},1032,["to"])]),"item.sell":t(({item:e})=>[e.sell?(X(),Ue(le,{key:0,icon:"mdi-check",color:"primary"})):_e("",!0)]),"item.edit":t(({item:e})=>[l(V,{icon:"mdi-pencil",variant:"text",color:"primary",onClick:p=>_(e)},null,8,["onClick"])]),"item.remove":t(({item:e})=>[l(V,{icon:"mdi-delete",variant:"text",color:"secondary",onClick:p=>T(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","search","items-length","loading"])]),_:1})]),_:1})]),_:1}),l(ee,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e),width:"300px"},{default:t(()=>[l(ae,{rounded:"xl"},{default:t(()=>[l(le,{icon:"mdi-alert-circle",color:"secondary",size:"50",class:"ma-auto mt-5"}),l(te,null,{default:t(()=>[b("確定要刪除「"+K(s(m).value.value)+"」嗎？此動作無法復原！",1)]),_:1}),l(oe,null,{default:t(()=>[l(se),l(V,{color:"primary",rounded:"",onClick:A},{default:t(()=>[b("取消")]),_:1}),l(V,{color:"secondary",rounded:"",onClick:de},{default:t(()=>[b("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ee,{modelValue:i.value,"onUpdate:modelValue":a[14]||(a[14]=e=>i.value=e),persistent:"",width:"500px"},{default:t(()=>[l(Ie,{disabled:s(g),onSubmit:Fe(s(ie),["prevent"])},{default:t(()=>[l(ae,{rounded:"xl"},{default:t(()=>[l(Ae,{class:"text-center mt-3 pb-0"},{default:t(()=>[b(K(u.value===""?"新增商品":"編輯商品"),1)]),_:1}),l(te,null,{default:t(()=>[l($,{label:"商品名稱",variant:"outlined",density:"compact",class:"pb-3",modelValue:s(m).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>s(m).value.value=e),"error-messages":s(m).errorMessage.value},null,8,["modelValue","error-messages"]),l($,{label:"價格",variant:"outlined",density:"compact",type:"number",min:"0",class:"pb-3",modelValue:s(k).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"]),l($,{label:"商品數量",variant:"outlined",density:"compact",type:"number",min:"0",class:"pb-3",modelValue:s(x).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"]),l(Le,{label:"分類",variant:"outlined",density:"compact",items:U,modelValue:s(S).value.value,"onUpdate:modelValue":a[9]||(a[9]=e=>s(S).value.value=e),"error-messages":s(S).errorMessage.value},null,8,["modelValue","error-messages"]),l(je,{label:"上架",density:"compact",modelValue:s(M).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(M).value.value=e),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ee,{label:"商品描述",variant:"outlined",density:"compact",modelValue:s(C).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(C).value.value=e),"error-messages":s(C).errorMessage.value},null,8,["modelValue","error-messages"]),l(c,{modelValue:h.value,"onUpdate:modelValue":a[12]||(a[12]=e=>h.value=e),rawModelValue:J.value,"onUpdate:rawModelValue":a[13]||(a[13]=e=>J.value=e),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇商品圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:B},null,8,["modelValue","rawModelValue","error-text"])]),_:1}),l(oe,null,{default:t(()=>[l(se),l(V,{color:"secondary",rounded:"",disabled:s(g),onClick:F},{default:t(()=>[b("取消")]),_:1},8,["disabled"]),l(V,{color:"primary",rounded:"",type:"submit",loading:s(g)},{default:t(()=>[b("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])])}}};export{ta as default};

import{_ as O,X as Q,Z as W,Y as ee,x as D,o as j,A as te,a0 as oe,a1 as i,a2 as v,c as t,a4 as o,ad as ae,aa as u,a8 as l,a5 as g,a6 as se,a7 as le,a9 as n,ac as p,J as h,T as re,U as ne,aj as ce,ak as I,a3 as L,V as de,aq as X,ae as ue,af as ie}from"./index-46534e73.js";import{c as pe,a as b,u as me,d as x,V as _e}from"./index.esm-1ed0acde.js";import{V as ve}from"./VContainer-1f50b779.js";import{V as M}from"./VRow-7f699dc8.js";import{V as r}from"./VCol-38d4cc39.js";import{V as E}from"./VChip-f1f9398b.js";import{V as J}from"./VDivider-c0c2ae3b.js";import{V as ye}from"./VSelect-6646c273.js";import{V as he}from"./VTextarea-a3baed7a.js";import"./VList-3fd21111.js";const V=C=>(ue("data-v-4cc46684"),C=C(),ie(),C),fe={style:{height:"100%"},class:"bg-back"},ke={key:0,class:"text-center text-grey-darken-1"},ge={key:0},be={class:"text-grey-darken-1"},xe={key:1},Ve={class:"text-decoration-line-through"},Ce=V(()=>n("p",{class:"text-secondary text-subtitle-2"},"商品已下架 或 暫時無庫存",-1)),we={class:"text-grey-darken-1"},Se={key:0,class:"text-secondary text-subtitle-2"},Te={class:"text-h5 font-weight-bold"},Be=V(()=>n("p",{class:"text-body-2 text-grey-darken-1"},"(運費另計)",-1)),Ne={class:"text-h5 font-weight-bold"},qe={key:0},$e=V(()=>n("b",{class:"text-h6 font-weight-bold"},"110",-1)),ze={key:1},Ie=V(()=>n("b",{class:"text-h6 font-weight-bold"},"70",-1)),Le={key:2},Me=V(()=>n("b",{class:"text-h6 font-weight-bold"},"0",-1)),Pe={__name:"CartView",setup(C){const{apiAuth:w}=ae(),y=Q(),m=W(),S=ee(),_=D([]),P=a=>m.likes.includes(a),U=j(()=>_.value.reduce((a,s)=>a+s.quantity*s.product.price,0)),T=D(!1),F=["黑貓","7-11 交貨便","面交"],Y=j(()=>_.value.length>0&&!_.value.some(a=>!a.product.sell)&&!_.value.some(a=>a.product.stock<=0)),B=async(a,s)=>{var c,e;if(!m.isLogin){S.push("/login");return}try{const{data:d}=await w.patch("/users/cart",{product:a,quantity:s});m.cart=d.result;const k=_.value.findIndex(K=>K.product._id===a);_.value[k].quantity+=s,_.value[k].quantity<=0&&_.value.splice(k,1),y({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"primary",location:"bottom"}})}catch(d){const k=((e=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";y({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},R=async a=>{var s,c;if(!m.isLogin){S.push("/login");return}try{await w.patch("/users/likes",{product:a});const e=m.likes.findIndex(d=>d===a);e>-1?m.likes.splice(e,1):m.likes.push(a),y({text:P(a)?"已加入收藏！":"已取消收藏！",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"back",location:"center"}})}catch(e){console.log(e);const d=((c=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";y({text:d,showCloseButton:!1,snackbarProps:{timeout:1e3,color:"secondary",location:"center"}})}},Z=pe({name:b().required("收件人姓名 必填"),phone:b().required("收件人電話 必填").min(10,"手機號碼格式錯誤").max(10,"手機號碼格式錯誤"),delivery:b().required("運送方式 必填").test("isCategory","運送方式錯誤",a=>F.includes(a)),address:b().required("收件地址 必填"),note:b()}),{handleSubmit:G,isSubmitting:A}=me({validationSchema:Z,initialValues:{name:"",phone:"",delivery:"",address:"",note:""}}),N=x("name"),q=x("phone"),f=x("delivery"),$=x("address"),z=x("note"),H=G(async a=>{var s,c;try{await w.post("/orders",{name:a.name,phone:a.phone,delivery:a.delivery,address:a.address,note:a.note}),m.cart=0,S.push("/myorders"),y({text:"訂單送出成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}})}catch(e){const d=((c=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";y({text:d,showCloseButton:!1,snackbarProps:{timeout:3e3,color:"secondary",location:"bottom"}}),setTimeout(()=>{S.go(0)},3e3)}});return te(async()=>{var a,s;try{const{data:c}=await w.get("/users/cart");_.value.push(...c.result)}catch(c){const e=((s=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";y({text:e,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),(a,s)=>{const c=oe("RouterLink");return i(),v("div",fe,[t(ve,null,{default:o(()=>[t(M,{class:"justify-center"},{default:o(()=>[t(r,{cols:"12",md:"11",class:"text-center mt-8"},{default:o(()=>[t(E,{class:"vchip-space text-body-2 text-md-body-1",variant:"outlined",size:"large",color:"primary","append-icon":"mdi-check-circle-outline"},{default:o(()=>[u("購物車 > 填寫運送資訊 > 送出訂單 > 付款")]),_:1}),t(J,{class:"mx-3 my-5"})]),_:1}),t(r,{cols:"12",md:"11"},{default:o(()=>[l(m).cart===0?(i(),v("p",ke,"----- 購物車沒有商品 -----")):g("",!0),(i(!0),v(se,null,le(_.value,e=>(i(),L(M,{key:e._id},{default:o(()=>[t(r,{cols:"6",lg:"3"},{default:o(()=>[t(c,{to:"/products/"+e.product._id},{default:o(()=>[t(de,{src:e.product.image,"aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024),t(r,{cols:"6",lg:"9",class:"d-flex flex-column flex-lg-row"},{default:o(()=>[t(r,{lg:"4"},{default:o(()=>[e.product.sell&&e.product.stock>0?(i(),v("div",ge,[n("h3",null,p(e.product.name),1),n("p",be,"NT. "+p(e.product.price),1)])):(i(),v("div",xe,[n("h3",Ve,p(e.product.name),1),Ce,n("p",we,"NT. "+p(e.product.price),1)])),t(E,{density:"comfortable",class:"mt-2",variant:"outlined",color:"primary"},{default:o(()=>[u(p(e.product.category),1)]),_:2},1024)]),_:2},1024),t(r,null,{default:o(()=>[n("p",{class:X(e.product.sell&&e.product.stock>0?[]:["text-grey"])},[u(" 數量： "),t(h,{icon:"mdi-minus",variant:"text",density:"compact",color:"primary",class:"mb-1",disabled:!e.product.sell||e.product.stock<=0,onClick:d=>B(e.product._id,-1)},null,8,["disabled","onClick"]),u(" "+p(e.quantity)+" ",1),t(h,{icon:"mdi-plus",variant:"text",density:"compact",color:"primary",class:"mb-1",disabled:!e.product.sell||e.product.stock<=0,onClick:d=>B(e.product._id,1)},null,8,["disabled","onClick"])],2),e.product.stock<=5&&e.product.stock>0?(i(),v("p",Se,"最後 "+p(e.product.stock)+" 組！",1)):g("",!0)]),_:2},1024),t(r,null,{default:o(()=>[n("p",{class:X(e.product.sell&&e.product.stock>0?[]:["text-grey"])},[u("小計：NT. "),n("b",null,p(e.product.price*e.quantity),1)],2)]),_:2},1024),t(r,{class:"d-flex",lg:"2"},{default:o(()=>[P(e.product._id)?(i(),L(h,{key:0,icon:"mdi-heart",size:"small",color:"secondary",variant:"outlined",class:"me-3",onClick:d=>R(e.product._id)},null,8,["onClick"])):(i(),L(h,{key:1,icon:"mdi-heart-outline",size:"small",color:"secondary",variant:"outlined",class:"me-3",onClick:d=>R(e.product._id)},null,8,["onClick"])),t(h,{icon:"mdi-delete",size:"small",color:"secondary",onClick:d=>B(e.product._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),t(J,{class:"mx-3 my-3"})]),_:2},1024))),128))]),_:1}),t(r,{cols:"12",md:"11",class:"text-end pe-10"},{default:o(()=>[n("p",null,[u("共 "),n("b",null,p(l(m).cart),1),u(" 件商品")]),n("p",null,[u("總計：NT. "),n("b",Te,p(U.value),1)]),Be]),_:1}),t(r,{cols:"12",md:"11",class:"text-end pe-10 mb-5"},{default:o(()=>[t(h,{color:"primary",size:"large",rounded:"","append-icon":"mdi-arrow-down-circle",onClick:s[0]||(s[0]=e=>T.value=!T.value)},{default:o(()=>[u("填寫運送資訊")]),_:1})]),_:1}),t(r,{cols:"12",md:"11",class:"text-end mb-16 pe-10"},{default:o(()=>[re(t(_e,{disabled:l(A),onSubmit:ce(l(H),["prevent"])},{default:o(()=>[t(M,null,{default:o(()=>[t(r,{cols:"12",md:"4"},{default:o(()=>[t(I,{"prepend-icon":"mdi-account-box-outline",label:"收件人姓名",placeholder:"王X明",hint:"請填寫真實姓名以利收件",variant:"outlined",density:"compact",modelValue:l(N).value.value,"onUpdate:modelValue":s[1]||(s[1]=e=>l(N).value.value=e),"error-messages":l(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(r,{cols:"12",md:"4"},{default:o(()=>[t(I,{"prepend-icon":"mdi-phone-outline",label:"收件人電話",placeholder:"0912345678",variant:"outlined",density:"compact",modelValue:l(q).value.value,"onUpdate:modelValue":s[2]||(s[2]=e=>l(q).value.value=e),"error-messages":l(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(r,{cols:"12",md:"4"},{default:o(()=>[t(ye,{"prepend-icon":"mdi-package-variant-closed-check",label:"運送方式",variant:"outlined",density:"compact",items:F,modelValue:l(f).value.value,"onUpdate:modelValue":s[3]||(s[3]=e=>l(f).value.value=e),"error-messages":l(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(r,{cols:"12",md:"12"},{default:o(()=>[t(I,{"prepend-icon":"mdi-map-marker-outline",label:"收件地址",placeholder:"請填寫宅配地址 或 7-11 門市，面交請填寫「面交」",variant:"outlined",density:"compact",modelValue:l($).value.value,"onUpdate:modelValue":s[4]||(s[4]=e=>l($).value.value=e),"error-messages":l($).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(r,{cols:"12"},{default:o(()=>[t(he,{"prepend-icon":"mdi-text",label:"訂單備註",variant:"outlined",density:"compact",clearable:"","auto-grow":"",modelValue:l(z).value.value,"onUpdate:modelValue":s[5]||(s[5]=e=>l(z).value.value=e),"error-messages":l(z).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(r,{cols:"12"},{default:o(()=>[n("p",null,[u("總計：NT. "),n("b",Ne,p(U.value),1)]),l(f).value.value==="黑貓"?(i(),v("p",qe,[u("運費：NT. "),$e])):g("",!0),l(f).value.value==="7-11 交貨便"?(i(),v("p",ze,[u("運費：NT. "),Ie])):g("",!0),l(f).value.value==="面交"?(i(),v("p",Le,[u("運費：NT. "),Me])):g("",!0)]),_:1}),t(r,{cols:"12"},{default:o(()=>[t(h,{type:"submit",color:"primary",size:"large",rounded:"","append-icon":"mdi-arrow-right-circle",disabled:!Y.value,loading:l(A)},{default:o(()=>[u("送出訂單")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"]),[[ne,T.value]])]),_:1})]),_:1})]),_:1})])}}},Ze=O(Pe,[["__scopeId","data-v-4cc46684"]]);export{Ze as default};

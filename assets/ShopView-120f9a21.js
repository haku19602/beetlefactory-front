import{_ as w,N as S,K as V,L as P,c as B,P as L,Q as p,S as _,T as s,h as t,a0 as I,ab as T,a8 as N,$ as u,a2 as y,ac as R,ad as A,V as h,a1 as D,a6 as O,a4 as $,a5 as j,Z as g,a3 as v,r as U,o as W,ae as q,R as x,W as E,X as F,i as K}from"./index-5c103a3f.js";import{V as M}from"./VChip-ca8043fe.js";import{V as Q}from"./VDivider-8b51d44a.js";import{g as X}from"./index-7d9a9c74.js";import{V as Z}from"./VContainer-95b6aa67.js";import{a as z,V as C}from"./VRow-c1778a5a.js";const G=a=>($("data-v-1e5f0148"),a=a(),j(),a),H=G(()=>g("h2",{class:"text-back sold-out pa-5"},[u("SOLD"),g("br"),u("OUT")],-1)),J={__name:"ProductCard",props:["_id","category","description","image","name","price","sell","stock"],setup(a){const{apiAuth:f}=v(),c=S(),n=V(),l=P(),r=a,o=B(()=>c.likes.includes(r._id)),k=async()=>{var i,d;if(!c.isLogin){l.push("/login");return}try{const{data:e}=await f.patch("/users/cart",{product:r._id,quantity:1});c.cart=e.result,n({text:"已加入購物車！",showCloseButton:!1,snackbarProps:{timeout:1500,color:"back",location:"center"}})}catch(e){const m=((d=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";n({text:m,showCloseButton:!1,snackbarProps:{timeout:1500,color:"secondary",location:"center"}})}},b=async()=>{var i,d;if(!c.isLogin){l.push("/login");return}try{await f.patch("/users/likes",{product:r._id});const e=c.likes.findIndex(m=>m===r._id);e>-1?c.likes.splice(e,1):c.likes.push(r._id),n({text:o.value?"已加入收藏！":"已取消收藏！",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"back",location:"center"}})}catch(e){console.log(e);const m=((d=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";n({text:m,showCloseButton:!1,snackbarProps:{timeout:1e3,color:"secondary",location:"center"}})}};return(i,d)=>{const e=L("RouterLink");return p(),_(O,{flat:"0",rounded:"md",class:"product-card",color:"back"},{default:s(()=>[t(e,{to:"/products/"+a._id},{default:s(()=>[t(I,{src:a.image,cover:"","aspect-ratio":"1"},{default:s(()=>[t(T,{"model-value":a.stock===0,contained:"",persistent:"",class:"align-center justify-center text-center",opacity:"0.5"},{default:s(()=>[H]),_:1},8,["model-value"])]),_:1},8,["src"])]),_:1},8,["to"]),t(N,{class:"d-flex justify-space-between pb-1"},{default:s(()=>[u(y(a.name),1),t(M,{density:"comfortable",variant:"outlined",color:"primary"},{default:s(()=>[u(y(a.category),1)]),_:1})]),_:1}),t(R,null,{default:s(()=>[u("NT. "+y(a.price),1)]),_:1}),t(Q,{class:"mx-3 mt-3"}),t(A,null,{default:s(()=>[t(h,{"prepend-icon":"mdi-cart",color:"primary",rounded:"",onClick:k,disabled:a.stock<=0},{default:s(()=>[u("加入購物車")]),_:1},8,["disabled"]),t(D),o.value?(p(),_(h,{key:0,icon:"mdi-heart",density:"comfortable",color:"secondary",onClick:b})):(p(),_(h,{key:1,icon:"mdi-heart-outline",density:"comfortable",color:"secondary",onClick:b}))]),_:1})]),_:1})}}},Y=w(J,[["__scopeId","data-v-1e5f0148"]]),ee={style:{height:"100%"},class:"bg-back"},te=g("h2",{class:"text-center text-primary"},"All",-1),le={__name:"ShopView",setup(a){const{api:f}=v(),c=V(),n=U([]);return W(async()=>{var l,r;try{const{data:o}=await f.get("/products",{params:{itemsPerPage:-1}});n.value.push(...o.result.data),await q(),X.from(".product-card",{y:80,duration:1.2,ease:"linear",stagger:.2})}catch(o){console.log(o);const k=((r=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";c({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),(l,r)=>(p(),x("div",ee,[t(Z,null,{default:s(()=>[t(z,null,{default:s(()=>[t(C,{cols:"12",class:"mt-6"},{default:s(()=>[te]),_:1}),(p(!0),x(E,null,F(n.value,o=>(p(),_(C,{cols:"6",md:"6",lg:"4",key:o._id},{default:s(()=>[t(Y,K(o,{class:"my-md-3 my-lg-5"}),null,16)]),_:2},1024))),128))]),_:1})]),_:1})]))}};export{le as default};

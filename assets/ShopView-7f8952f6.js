import{_ as w,Z as S,X as C,Y as P,o as B,a0 as L,a1 as m,a3 as _,a4 as s,c as a,V as I,al as A,ai as T,aa as u,ac as y,am as N,an as R,J as h,ab as D,ag as O,ae as j,af as U,a9 as g,ad as v,x as $,A as q,ao as E,a2 as x,a6 as F,a7 as G,G as J}from"./index-7de24ab8.js";import{V as M}from"./VChip-febfb745.js";import{V as W}from"./VDivider-81fcde55.js";import{g as X}from"./index-7d9a9c74.js";import{V as Y}from"./VContainer-5cecc9e2.js";import{V as Z}from"./VRow-34dcdaa6.js";import{V}from"./VCol-8840a17d.js";const z=t=>(j("data-v-1e5f0148"),t=t(),U(),t),H=z(()=>g("h2",{class:"text-back sold-out pa-5"},[u("SOLD"),g("br"),u("OUT")],-1)),K={__name:"ProductCard",props:["_id","category","description","image","name","price","sell","stock"],setup(t){const{apiAuth:f}=v(),c=S(),n=C(),l=P(),r=t,o=B(()=>c.likes.includes(r._id)),k=async()=>{var i,d;if(!c.isLogin){l.push("/login");return}try{const{data:e}=await f.patch("/users/cart",{product:r._id,quantity:1});c.cart=e.result,n({text:"已加入購物車！",showCloseButton:!1,snackbarProps:{timeout:1500,color:"back",location:"center"}})}catch(e){const p=((d=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";n({text:p,showCloseButton:!1,snackbarProps:{timeout:1500,color:"secondary",location:"center"}})}},b=async()=>{var i,d;if(!c.isLogin){l.push("/login");return}try{await f.patch("/users/likes",{product:r._id});const e=c.likes.findIndex(p=>p===r._id);e>-1?c.likes.splice(e,1):c.likes.push(r._id),n({text:o.value?"已加入收藏！":"已取消收藏！",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"back",location:"center"}})}catch(e){console.log(e);const p=((d=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";n({text:p,showCloseButton:!1,snackbarProps:{timeout:1e3,color:"secondary",location:"center"}})}};return(i,d)=>{const e=L("RouterLink");return m(),_(O,{flat:"0",rounded:"md",class:"product-card",color:"back"},{default:s(()=>[a(e,{to:"/products/"+t._id},{default:s(()=>[a(I,{src:t.image,cover:"","aspect-ratio":"1"},{default:s(()=>[a(A,{"model-value":t.stock===0,contained:"",persistent:"",class:"align-center justify-center text-center",opacity:"0.5"},{default:s(()=>[H]),_:1},8,["model-value"])]),_:1},8,["src"])]),_:1},8,["to"]),a(T,{class:"d-flex justify-space-between pb-1"},{default:s(()=>[u(y(t.name),1),a(M,{density:"comfortable",variant:"outlined",color:"primary"},{default:s(()=>[u(y(t.category),1)]),_:1})]),_:1}),a(N,null,{default:s(()=>[u("NT. "+y(t.price),1)]),_:1}),a(W,{class:"mx-3 mt-3"}),a(R,null,{default:s(()=>[a(h,{"prepend-icon":"mdi-cart",color:"primary",rounded:"",onClick:k,disabled:t.stock<=0},{default:s(()=>[u("加入購物車")]),_:1},8,["disabled"]),a(D),o.value?(m(),_(h,{key:0,icon:"mdi-heart",density:"comfortable",color:"secondary",onClick:b})):(m(),_(h,{key:1,icon:"mdi-heart-outline",density:"comfortable",color:"secondary",onClick:b}))]),_:1})]),_:1})}}},Q=w(K,[["__scopeId","data-v-1e5f0148"]]),ee={style:{height:"100%"},class:"bg-back"},ae=g("h2",{class:"text-center text-primary"},"All",-1),ie={__name:"ShopView",setup(t){const{api:f}=v(),c=C(),n=$([]);return q(async()=>{var l,r;try{const{data:o}=await f.get("/products",{params:{itemsPerPage:-1}});n.value.push(...o.result.data),await E(),X.from(".product-card",{y:80,duration:1.2,ease:"linear",stagger:.2})}catch(o){console.log(o);const k=((r=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";c({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),(l,r)=>(m(),x("div",ee,[a(Y,null,{default:s(()=>[a(Z,null,{default:s(()=>[a(V,{cols:"12",class:"mt-6"},{default:s(()=>[ae]),_:1}),(m(!0),x(F,null,G(n.value,o=>(m(),_(V,{cols:"6",md:"6",lg:"4",key:o._id},{default:s(()=>[a(Q,J(o,{class:"my-md-3 my-lg-5"}),null,16)]),_:2},1024))),128))]),_:1})]),_:1})]))}};export{ie as default};

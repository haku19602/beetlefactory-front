import{N as X,K as Y,r as c,P as Z,Q as M,R,h as e,T as l,ah as G,a3 as H,a6 as S,W as O,X as ee,ai as ae,Y as o,V as y,Z as j,a2 as z,J as B,$ as i,a1 as F,aj as le,S as E,a9 as te,a8 as oe,aa as x,ad as N}from"./index-c505dd87.js";import{v as se}from"./index-054de6d9.js";import{c as re,a as _,u as ue,d as k,V as ne}from"./index.esm-67307f81.js";import{V as ie}from"./VContainer-c8701468.js";import{a as $,V as u}from"./VRow-b1561833.js";import{b as de,V as ce}from"./VList-97a9c3f1.js";import{V as me,b as ve}from"./VToolbar-d6f4a6d7.js";import{V as pe}from"./VDivider-f3bbd198.js";const fe={style:{height:"100%"},class:"bg-back"},ge={class:"text-primary"},Ve={class:"text-primary"},Se={__name:"MySetting",setup(be){const s=X(),{apiAuth:A}=H(),h=Y(),L=[{to:"/mysetting",text:"會員設定",icon:"mdi-cog"},{to:"/mylikes",text:"我的收藏",icon:"mdi-heart"},{to:"/myorders",text:"我的訂單",icon:"mdi-list-box"}],d=c(!1),U=c(null),w=c(!1),q=r=>{w.value=!0},T=()=>{w.value=!1,U.value.deleteFileRecord()},C=c(!1),I=re({account:_().required("缺少使用者帳號").min(4,"帳號名稱最少 4 字").max(20,"帳號名稱最多 20 字"),email:_().required("使用者信箱必填").test("isEmail","信箱格式錯誤",r=>se.isEmail(r)),name:_(),phone:_(),address:_()}),{handleSubmit:J,isSubmitting:P}=ue({validationSchema:I,initialValues:{account:"",email:"",name:"",phone:"",address:""}}),m=k("account"),v=k("email"),p=k("name"),f=k("phone"),g=k("address");m.value.value=s.account,v.value.value=s.email,p.value.value=s.name,f.value.value=s.phone,g.value.value=s.address;const K=()=>{m.value.value=s.account,v.value.value=s.email,p.value.value=s.name,f.value.value=s.phone,g.value.value=s.address,d.value=!1},Q=J(async r=>{var t,n;try{await A.patch("/users/self",r),console.log(r),s.getProfile(),h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"center"}}),d.value=!1}catch(a){console.log(a);const b=((n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";h({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"center"}})}}),V=c([]),D=c([]),W=async()=>{var r,t,n;if(C.value=!0,!((r=V.value[0])!=null&&r.error)){try{const a=new FormData;V.value.length>0&&a.append("image",V.value[0].file),await A.patch("/users/avatar",a),s.getProfile(),h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),T()}catch(a){console.log(a);const b=((n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";h({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}C.value=!1}};return(r,t)=>{const n=Z("VueFileAgent");return M(),R("div",fe,[e(ie,null,{default:l(()=>[e($,{class:"justify-center pt-10"},{default:l(()=>[e(u,{cols:"5",sm:"4",md:"3",lg:"2"},{default:l(()=>[e(S,{class:"mx-auto","max-width":"300",flat:"0",width:"200"},{default:l(()=>[e(de,{density:"compact",class:"bg-back"},{default:l(()=>[(M(),R(O,null,ee(L,(a,b)=>e(ce,{key:b,to:a.to,"prepend-icon":a.icon,title:a.text,color:"primary",rounded:"xl"},null,8,["to","prepend-icon","title"])),64))]),_:1})]),_:1})]),_:1}),e(u,{cols:"8",sm:"7",md:"9",lg:"4",class:"text-center"},{default:l(()=>[e(ae,{image:o(s).avatar,size:"260"},null,8,["image"]),e(y,{icon:"mdi-pencil",size:"x-small",color:"primary",style:{"vertical-align":"bottom"},onClick:q}),j("h2",ge,z(o(s).account),1),j("h3",Ve,z(o(s).email),1)]),_:1}),e(u,{cols:"12",sm:"11",md:"12",lg:"6"},{default:l(()=>[e(S,{class:"bg-back"},{default:l(()=>[e(me,{flat:"",color:"primary"},{default:l(()=>[e(B,{class:"ps-8"},{default:l(()=>[i("mdi-account")]),_:1}),e(ve,{class:"font-weight-bold"},{default:l(()=>[i("會員資料")]),_:1}),e(F),e(y,{icon:""},{default:l(()=>[e(le,{"leave-absolute":""},{default:l(()=>[d.value?(M(),E(B,{key:0,onClick:K},{default:l(()=>[i("mdi-close")]),_:1})):(M(),E(B,{key:1,onClick:t[0]||(t[0]=a=>d.value=!0)},{default:l(()=>[i("mdi-pencil")]),_:1}))]),_:1})]),_:1})]),_:1}),e(ne,{disabled:!d.value||o(P),onSubmit:te(o(Q),["prevent"])},{default:l(()=>[e(oe,{class:"pa-10"},{default:l(()=>[e($,null,{default:l(()=>[e(u,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"信箱",variant:"outlined",density:"comfortable",modelValue:o(v).value.value,"onUpdate:modelValue":t[1]||(t[1]=a=>o(v).value.value=a),"error-messages":o(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"帳號",variant:"outlined",density:"comfortable",modelValue:o(m).value.value,"onUpdate:modelValue":t[2]||(t[2]=a=>o(m).value.value=a),"error-messages":o(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件人",variant:"outlined",density:"comfortable",modelValue:o(p).value.value,"onUpdate:modelValue":t[3]||(t[3]=a=>o(p).value.value=a),"error-messages":o(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"6",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件電話",variant:"outlined",density:"comfortable",modelValue:o(f).value.value,"onUpdate:modelValue":t[4]||(t[4]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件地址",variant:"outlined",density:"comfortable",modelValue:o(g).value.value,"onUpdate:modelValue":t[5]||(t[5]=a=>o(g).value.value=a),"error-messages":o(g).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(pe),e(N,null,{default:l(()=>[e(F),e(y,{type:"submit",color:"primary",rounded:"",disabled:!d.value,loading:o(P)},{default:l(()=>[i("儲存")]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1}),e(G,{modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=a=>w.value=a),width:"300px"},{default:l(()=>[e(S,{rounded:"xl",class:"px-5 pt-5"},{default:l(()=>[e(n,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=a=>V.value=a),rawModelValue:D.value,"onUpdate:rawModelValue":t[7]||(t[7]=a=>D.value=a),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:U},null,8,["modelValue","rawModelValue","error-text"]),e(N,null,{default:l(()=>[e(F),e(y,{color:"secondary",rounded:"",onClick:T,disabled:C.value},{default:l(()=>[i("取消")]),_:1},8,["disabled"]),e(y,{color:"primary",rounded:"",onClick:W,loading:C.value},{default:l(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Se as default};

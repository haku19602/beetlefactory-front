import{p as le,g as te,u as oe,c as a,G as L,aA as de,aB as ce,K as z,aD as me,o as pe,D as ve,aE as ge,aF as K,a6 as fe,aR as Ve,X as be,x as u,a0 as ye,a1 as E,a2 as ke,a4 as t,aP as H,ad as xe,ak as N,aQ as Ce,V as he,a3 as Pe,a5 as we,J as P,ag as J,W as Q,ai as W,aa as V,ac as Ie,a8 as n,an as X,ab as Y,aj as Re,ah as Se,a9 as se}from"./index-2680eac0.js";import{c as _e,a as Z,e as Be,u as Ae,d as O}from"./index.esm-bc5ef2ae.js";import{V as Ue}from"./VContainer-acdc9872.js";import{a as Fe,V as ee}from"./VRow-46c6a7e3.js";import{V as De}from"./VDataTableServer-8bc46f38.js";import{V as Me}from"./VForm-d7dd8030.js";import{b as $e,c as re,d as Ge,e as Te}from"./VSelect-cb52920b.js";import"./VDivider-040db6bb.js";import"./VList-1b07ef35.js";import"./VChip-ffa9af1d.js";const Ne=le({...$e({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),ae=te()({name:"VRadio",props:Ne(),setup(r,p){let{slots:c}=p;return oe(()=>a(re,L(r,{class:["v-radio",r.class],style:r.style,type:"radio"}),c)),{}}});const Oe=le({height:{type:[Number,String],default:"auto"},...de(),...ce(Ge(),["multiple"]),trueIcon:{type:z,default:"$radioOn"},falseIcon:{type:z,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Le=te()({name:"VRadioGroup",inheritAttrs:!1,props:Oe(),emits:{"update:modelValue":r=>!0},setup(r,p){let{attrs:c,slots:v}=p;const b=me(),g=pe(()=>r.id||`radio-group-${b}`),d=ve(r,"modelValue");return oe(()=>{const[U,R]=ge(c),F=K.filterProps(r),S=re.filterProps(r),w=v.label?v.label({label:r.label,props:{for:g.value}}):r.label;return a(K,L({class:["v-radio-group",r.class],style:r.style},U,F,{modelValue:d.value,"onUpdate:modelValue":I=>d.value=I,id:g.value}),{...v,default:I=>{let{id:f,messagesId:D,isDisabled:m,isReadonly:y}=I;return a(fe,null,[w&&a(Ve,{id:f.value},{default:()=>[w]}),a(Te,L(S,{id:f.value,"aria-describedby":D.value,defaultsTarget:"VRadio",trueIcon:r.trueIcon,falseIcon:r.falseIcon,type:r.type,disabled:m.value,readonly:y.value,"aria-labelledby":w?f.value:void 0,multiple:!1},R,{modelValue:d.value,"onUpdate:modelValue":k=>d.value=k}),v)])}})}),{}}}),je={style:{height:"100%"},class:"bg-back"},qe=se("h2",{class:"text-center mt-5 text-primary"},"會員列表",-1),ze=se("br",null,null,-1),aa={__name:"MembersView",setup(r){const{apiAuth:p}=xe(),c=be(),v=u(null),b=u(!1),g=u(!1),d=u(""),U=o=>{o?(d.value=o._id,m.value.value=o.account,y.value.value=o.email,k.value.value=o.role):d.value="",b.value=!0},R=()=>{b.value=!1,D(),v.value.deleteFileRecord()},F=o=>{d.value=o._id,m.value.value=o.account,g.value=!0},S=()=>{g.value=!1},w=_e({account:Z().required("缺少使用者帳號").min(4,"帳號名稱最少 4 字").max(20,"帳號名稱最多 20 字"),email:Z().required("缺少使用者信箱"),role:Be().required("缺少使用者角色")}),{handleSubmit:I,isSubmitting:f,resetForm:D}=Ae({validationSchema:w,initialValues:{account:"",email:0,role:0}}),m=O("account"),y=O("email"),k=O("role"),x=u([]),j=u([]),ne=async()=>{var o,l;try{await p.delete("/users/"+d.value),c({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),S(),C()}catch(i){console.log(i);const e=((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";c({text:e,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},ue=I(async o=>{var l,i,e;if(!((l=x.value[0])!=null&&l.error)&&!(d.value===""&&x.value.length===0))try{const s=new FormData;for(const h in o)s.append(h,o[h]);x.value.length>0&&s.append("image",x.value[0].file),await p.patch("/users/"+d.value,s),c({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),R(),T()}catch(s){console.log(s);const h=((e=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";c({text:h,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),M=u(10),_=u([{key:"createdAt",order:"desc"}]),B=u(1),$=u([]),ie=[{title:"大頭貼",align:"center",sortable:!1,key:"avatar"},{title:"帳號",align:"center",sortable:!0,key:"account"},{title:"信箱",align:"center",sortable:!0,key:"email"},{title:"管理員",align:"center",sortable:!0,key:"role"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],G=u(!0),q=u(0),A=u(""),C=async()=>{var o,l,i,e;G.value=!0;try{const{data:s}=await p.get("/users/all",{params:{page:B.value,itemsPerPage:M.value,sortBy:((o=_.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=_.value[0])==null?void 0:l.order)==="asc"?1:-1,search:A.value}});$.value.splice(0,$.value.length,...s.result.data),q.value=s.result.total}catch(s){console.log(s);const h=((e=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";c({text:h,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}G.value=!1};C();const T=()=>{B.value=1,C()};return(o,l)=>{const i=ye("VueFileAgent");return E(),ke("div",je,[a(Ue,null,{default:t(()=>[a(Fe,null,{default:t(()=>[a(ee,{cols:"12"},{default:t(()=>[qe]),_:1}),a(ee,{cols:"10",class:"mx-auto"},{default:t(()=>[a(De,{"items-per-page":M.value,"onUpdate:itemsPerPage":[l[1]||(l[1]=e=>M.value=e),C],"sort-by":_.value,"onUpdate:sortBy":[l[2]||(l[2]=e=>_.value=e),C],page:B.value,"onUpdate:page":[l[3]||(l[3]=e=>B.value=e),C],items:$.value,headers:ie,loading:G.value,"items-length":q.value,search:A.value,class:"py-5 px-10 bg-back"},{top:t(()=>[a(N,{label:"搜尋","append-inner-icon":"mdi-magnify",modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value=e),variant:"underlined","onClick:appendInner":T,onKeydown:Ce(T,["enter"])},null,8,["modelValue"])]),"item.avatar":t(({item:e})=>[a(he,{src:e.avatar,height:"30px",contain:""},null,8,["src"])]),"item.role":t(({item:e})=>[e.role===1?(E(),Pe(Q,{key:0,icon:"mdi-check",color:"primary"})):we("",!0)]),"item.edit":t(({item:e})=>[a(P,{icon:"mdi-pencil",variant:"text",color:"primary",onClick:s=>U(e)},null,8,["onClick"])]),"item.remove":t(({item:e})=>[a(P,{icon:"mdi-delete",variant:"text",color:"secondary",onClick:s=>F(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(H,{modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=e=>g.value=e),width:"300px"},{default:t(()=>[a(J,{rounded:"xl"},{default:t(()=>[a(Q,{icon:"mdi-alert-circle",color:"secondary",size:"50",class:"ma-auto mt-5"}),a(W,null,{default:t(()=>[V("確定要刪除「"+Ie(n(m).value.value)+"」嗎？ ",1),ze,V(" 此動作無法復原！")]),_:1}),a(X,null,{default:t(()=>[a(Y),a(P,{color:"primary",rounded:"",onClick:S},{default:t(()=>[V("取消")]),_:1}),a(P,{color:"secondary",rounded:"",onClick:ne},{default:t(()=>[V("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:b.value,"onUpdate:modelValue":l[10]||(l[10]=e=>b.value=e),persistent:"",width:"500px"},{default:t(()=>[a(Me,{disabled:n(f),onSubmit:Re(n(ue),["prevent"])},{default:t(()=>[a(J,{rounded:"xl"},{default:t(()=>[a(Se,{class:"text-center mt-3 pb-0"},{default:t(()=>[V("編輯使用者")]),_:1}),a(W,null,{default:t(()=>[a(N,{label:"帳號",variant:"outlined",density:"compact",class:"pb-3",minlength:"4",maxlength:"20",counter:"",modelValue:n(m).value.value,"onUpdate:modelValue":l[5]||(l[5]=e=>n(m).value.value=e),"error-messages":n(m).errorMessage.value},null,8,["modelValue","error-messages"]),a(N,{label:"信箱",variant:"outlined",density:"compact",type:"email",min:"0",class:"pb-3",modelValue:n(y).value.value,"onUpdate:modelValue":l[6]||(l[6]=e=>n(y).value.value=e),"error-messages":n(y).errorMessage.value},null,8,["modelValue","error-messages"]),a(Le,{modelValue:n(k).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>n(k).value.value=e),"error-messages":n(k).errorMessage.value,inline:""},{default:t(()=>[a(ae,{label:"一般會員",value:0}),a(ae,{label:"管理員",value:1})]),_:1},8,["modelValue","error-messages"]),a(i,{modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=e=>x.value=e),rawModelValue:j.value,"onUpdate:rawModelValue":l[9]||(l[9]=e=>j.value=e),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:v},null,8,["modelValue","rawModelValue","error-text"])]),_:1}),a(X,null,{default:t(()=>[a(Y),a(P,{color:"secondary",rounded:"",disabled:n(f),onClick:R},{default:t(()=>[V("取消")]),_:1},8,["disabled"]),a(P,{color:"primary",rounded:"",type:"submit",loading:n(f)},{default:t(()=>[V("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])])}}};export{aa as default};

import{N as Y,K as Z,L as G,r as g,P as H,Q as M,R as P,h as e,T as l,ah as O,a3 as ee,a6 as S,W as ae,X as le,ai as oe,Y as t,V as y,Z as j,a2 as z,J as B,$ as i,a1 as F,aj as te,S as E,a9 as se,a8 as ue,aa as x,ad as L}from"./index-b20e0ee4.js";import{v as re}from"./index-96062105.js";import{c as ne,a as _,u as ie,d as k,V as de}from"./index.esm-1b04f6ff.js";import{V as me}from"./VContainer-39409a50.js";import{a as N,V as r}from"./VRow-297c7f6d.js";import{b as ce,V as ve}from"./VList-a17c7a0a.js";import{V as pe,b as fe}from"./VToolbar-77143cfa.js";import{V as ge}from"./VDivider-b710a258.js";const Ve={style:{height:"100%"},class:"bg-back"},be={class:"text-primary"},ye={class:"text-primary"},Fe={__name:"MySetting",setup(xe){const s=Y(),{apiAuth:A}=ee(),h=Z(),$=G(),q=[{to:"/mysetting",text:"會員設定",icon:"mdi-cog"},{to:"/mylikes",text:"我的收藏",icon:"mdi-heart"},{to:"/myorders",text:"我的訂單",icon:"mdi-list-box"}],d=g(!1),U=g(null),w=g(!1),I=u=>{w.value=!0},T=()=>{w.value=!1,U.value.deleteFileRecord()},C=g(!1),J=ne({account:_().required("缺少使用者帳號").min(4,"帳號名稱最少 4 字").max(20,"帳號名稱最多 20 字"),email:_().required("使用者信箱必填").test("isEmail","信箱格式錯誤",u=>re.isEmail(u)),name:_(),phone:_(),address:_()}),{handleSubmit:K,isSubmitting:D}=ie({validationSchema:J,initialValues:{account:"",email:"",name:"",phone:"",address:""}}),m=k("account"),c=k("email"),v=k("name"),p=k("phone"),f=k("address");m.value.value=s.account,c.value.value=s.email,v.value.value=s.name,p.value.value=s.phone,f.value.value=s.address;const Q=()=>{m.value.value=s.account,c.value.value=s.email,v.value.value=s.name,p.value.value=s.phone,f.value.value=s.address,d.value=!1},W=K(async u=>{var o,n;try{await A.patch("/users/self",u),console.log(u),s.account=m.value.value,s.email=c.value.value,s.name=v.value.value,s.phone=p.value.value,s.address=f.value.value,h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),d.value=!1}catch(a){console.log(a);const b=((n=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";h({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),V=g([]),R=g([]),X=async()=>{var u,o,n;if(C.value=!0,!((u=V.value[0])!=null&&u.error)){try{const a=new FormData;V.value.length>0&&a.append("image",V.value[0].file),await A.patch("/users/avatar",a),$.go(0),h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),T()}catch(a){console.log(a);const b=((n=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";h({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}C.value=!1}};return(u,o)=>{const n=H("VueFileAgent");return M(),P("div",Ve,[e(me,null,{default:l(()=>[e(N,{class:"justify-center pt-10"},{default:l(()=>[e(r,{cols:"5",sm:"4",md:"3",lg:"2"},{default:l(()=>[e(S,{class:"mx-auto","max-width":"300",flat:"0",width:"200"},{default:l(()=>[e(ce,{density:"compact",class:"bg-back"},{default:l(()=>[(M(),P(ae,null,le(q,(a,b)=>e(ve,{key:b,to:a.to,"prepend-icon":a.icon,title:a.text,color:"primary",rounded:"xl"},null,8,["to","prepend-icon","title"])),64))]),_:1})]),_:1})]),_:1}),e(r,{cols:"8",sm:"7",md:"9",lg:"4"},{default:l(()=>[e(oe,{image:t(s).avatar,size:"300"},null,8,["image"]),e(y,{icon:"mdi-pencil",size:"x-small",color:"primary",style:{"vertical-align":"bottom"},onClick:I}),j("h2",be,z(t(s).account),1),j("h3",ye,z(t(s).email),1)]),_:1}),e(r,{cols:"12",sm:"11",md:"12",lg:"6"},{default:l(()=>[e(S,{class:"bg-back"},{default:l(()=>[e(pe,{flat:"",color:"primary"},{default:l(()=>[e(B,{class:"ps-8"},{default:l(()=>[i("mdi-account")]),_:1}),e(fe,{class:"font-weight-bold"},{default:l(()=>[i("會員資料")]),_:1}),e(F),e(y,{icon:""},{default:l(()=>[e(te,{"leave-absolute":""},{default:l(()=>[d.value?(M(),E(B,{key:0,onClick:Q},{default:l(()=>[i("mdi-close")]),_:1})):(M(),E(B,{key:1,onClick:o[0]||(o[0]=a=>d.value=!0)},{default:l(()=>[i("mdi-pencil")]),_:1}))]),_:1})]),_:1})]),_:1}),e(de,{disabled:!d.value||t(D),onSubmit:se(t(W),["prevent"])},{default:l(()=>[e(ue,{class:"pa-10"},{default:l(()=>[e(N,null,{default:l(()=>[e(r,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"信箱",variant:"outlined",density:"comfortable",modelValue:t(c).value.value,"onUpdate:modelValue":o[1]||(o[1]=a=>t(c).value.value=a),"error-messages":t(c).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"帳號",variant:"outlined",density:"comfortable",modelValue:t(m).value.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t(m).value.value=a),"error-messages":t(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件人",variant:"outlined",density:"comfortable",modelValue:t(v).value.value,"onUpdate:modelValue":o[3]||(o[3]=a=>t(v).value.value=a),"error-messages":t(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"6",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件電話",variant:"outlined",density:"comfortable",modelValue:t(p).value.value,"onUpdate:modelValue":o[4]||(o[4]=a=>t(p).value.value=a),"error-messages":t(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(r,{cols:"12",class:"pb-0"},{default:l(()=>[e(x,{label:"常用收件地址",variant:"outlined",density:"comfortable",modelValue:t(f).value.value,"onUpdate:modelValue":o[5]||(o[5]=a=>t(f).value.value=a),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(ge),e(L,null,{default:l(()=>[e(F),e(y,{type:"submit",color:"primary",rounded:"",disabled:!d.value,loading:t(D)},{default:l(()=>[i("儲存")]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{modelValue:w.value,"onUpdate:modelValue":o[8]||(o[8]=a=>w.value=a),width:"300px"},{default:l(()=>[e(S,{rounded:"xl",class:"px-5 pt-5"},{default:l(()=>[e(n,{modelValue:V.value,"onUpdate:modelValue":o[6]||(o[6]=a=>V.value=a),rawModelValue:R.value,"onUpdate:rawModelValue":o[7]||(o[7]=a=>R.value=a),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:U},null,8,["modelValue","rawModelValue","error-text"]),e(L,null,{default:l(()=>[e(F),e(y,{color:"secondary",rounded:"",onClick:T,disabled:C.value},{default:l(()=>[i("取消")]),_:1},8,["disabled"]),e(y,{color:"primary",rounded:"",onClick:X,loading:C.value},{default:l(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Fe as default};

import{p as le,g as te,f as oe,h as e,i as O,aE as de,aF as ce,I as K,aH as me,c as pe,u as ve,aI as ge,aJ as L,W as fe,aY as Ve,K as be,r as u,P as ye,Q as q,R as ke,T as t,aj as H,a3 as xe,aa as T,aK as Ce,ak as Pe,a0 as he,S as we,U as Ie,V as P,a6 as J,J as Y,a8 as Q,$ as V,a2 as Re,Y as n,ad as W,a1 as Z,a9 as Se,a7 as _e,Z as se}from"./index-724c5dd8.js";import{v as Ue}from"./index-8639c00b.js";import{c as Ae,a as X,e as Be,u as Fe,d as N,V as $e}from"./index.esm-8b373f45.js";import{V as Me}from"./VContainer-a3e58365.js";import{a as De,V as ee}from"./VRow-48d9a503.js";import{V as Ge}from"./VDataTableServer-676bf133.js";import{b as Te,c as re,d as Ne,e as Oe}from"./VSelect-fd6e1fad.js";import"./VDataTable-4089ef8b.js";import"./VDivider-077b5e61.js";import"./VList-45b21e71.js";import"./VChip-4cb80cf1.js";const je=le({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),ae=te()({name:"VRadio",props:je(),setup(r,p){let{slots:c}=p;return oe(()=>e(re,O(r,{class:["v-radio",r.class],style:r.style,type:"radio"}),c)),{}}});const ze=le({height:{type:[Number,String],default:"auto"},...de(),...ce(Ne(),["multiple"]),trueIcon:{type:K,default:"$radioOn"},falseIcon:{type:K,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Ee=te()({name:"VRadioGroup",inheritAttrs:!1,props:ze(),emits:{"update:modelValue":r=>!0},setup(r,p){let{attrs:c,slots:v}=p;const b=me(),g=pe(()=>r.id||`radio-group-${b}`),d=ve(r,"modelValue");return oe(()=>{const[B,R]=ge(c),F=L.filterProps(r),S=re.filterProps(r),h=v.label?v.label({label:r.label,props:{for:g.value}}):r.label;return e(L,O({class:["v-radio-group",r.class],style:r.style},B,F,{modelValue:d.value,"onUpdate:modelValue":w=>d.value=w,id:g.value}),{...v,default:w=>{let{id:f,messagesId:$,isDisabled:m,isReadonly:y}=w;return e(fe,null,[h&&e(Ve,{id:f.value},{default:()=>[h]}),e(Oe,O(S,{id:f.value,"aria-describedby":$.value,defaultsTarget:"VRadio",trueIcon:r.trueIcon,falseIcon:r.falseIcon,type:r.type,disabled:m.value,readonly:y.value,"aria-labelledby":h?f.value:void 0,multiple:!1},R,{modelValue:d.value,"onUpdate:modelValue":k=>d.value=k}),v)])}})}),{}}}),Ke={style:{height:"100%"},class:"bg-back"},Le=se("h2",{class:"text-center mt-10 text-primary"},"會員列表",-1),qe=se("br",null,null,-1),oa={__name:"MembersView",setup(r){const{apiAuth:p}=xe(),c=be(),v=u(null),b=u(!1),g=u(!1),d=u(""),B=o=>{o?(d.value=o._id,m.value.value=o.account,y.value.value=o.email,k.value.value=o.role):d.value="",b.value=!0},R=()=>{b.value=!1,$(),v.value.deleteFileRecord()},F=o=>{d.value=o._id,m.value.value=o.account,g.value=!0},S=()=>{g.value=!1},h=Ae({account:X().required("缺少使用者帳號").min(4,"帳號名稱最少 4 字").max(20,"帳號名稱最多 20 字"),email:X().required("使用者信箱必填").test("isEmail","信箱格式錯誤",o=>Ue.isEmail(o)),role:Be().required("缺少使用者角色")}),{handleSubmit:w,isSubmitting:f,resetForm:$}=Fe({validationSchema:h,initialValues:{account:"",email:"",role:0}}),m=N("account"),y=N("email"),k=N("role"),I=u([]),j=u([]),ne=async()=>{var o,l;try{await p.delete("/users/"+d.value),c({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),S(),x()}catch(i){console.log(i);const a=((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";c({text:a,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},ue=w(async o=>{var l,i,a;if(!((l=I.value[0])!=null&&l.error))try{const s=new FormData;for(const C in o)s.append(C,o[C]);I.value.length>0&&s.append("image",I.value[0].file),await p.patch("/users/"+d.value,s),c({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),R(),E()}catch(s){console.log(s);const C=((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";c({text:C,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),M=u(10),_=u([{key:"createdAt",order:"desc"}]),U=u(1),D=u([]),ie=[{title:"大頭貼",align:"center",sortable:!1,key:"avatar"},{title:"帳號",align:"center",sortable:!0,key:"account"},{title:"信箱",align:"center",sortable:!0,key:"email"},{title:"管理員",align:"center",sortable:!0,key:"role"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],G=u(!0),z=u(0),A=u(""),x=async()=>{var o,l,i,a;G.value=!0;try{const{data:s}=await p.get("/users/all",{params:{page:U.value,itemsPerPage:M.value,sortBy:((o=_.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=_.value[0])==null?void 0:l.order)==="asc"?1:-1,search:A.value}});D.value.splice(0,D.value.length,...s.result.data),z.value=s.result.total}catch(s){console.log(s);const C=((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";c({text:C,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}G.value=!1};x();const E=()=>{U.value=1,x()};return(o,l)=>{const i=ye("VueFileAgent");return q(),ke("div",Ke,[e(Me,null,{default:t(()=>[e(De,{class:"justify-center"},{default:t(()=>[e(ee,{cols:"12",lg:"10"},{default:t(()=>[Le]),_:1}),e(ee,{cols:"12",lg:"10"},{default:t(()=>[e(Ge,{"items-per-page":M.value,"onUpdate:itemsPerPage":[l[1]||(l[1]=a=>M.value=a),x],"sort-by":_.value,"onUpdate:sortBy":[l[2]||(l[2]=a=>_.value=a),x],page:U.value,"onUpdate:page":[l[3]||(l[3]=a=>U.value=a),x],items:D.value,headers:ie,loading:G.value,"items-length":z.value,search:A.value,class:"py-5 px-10 bg-back"},{top:t(()=>[e(T,{label:"搜尋","prepend-inner-icon":"mdi-magnify",modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=a=>A.value=a),variant:"underlined",onKeydown:Ce(E,["enter"])},null,8,["modelValue"])]),"item.avatar":t(({item:a})=>[e(Pe,{size:"30"},{default:t(()=>[e(he,{src:a.avatar,contain:""},null,8,["src"])]),_:2},1024)]),"item.role":t(({item:a})=>[a.role===1?(q(),we(Y,{key:0,icon:"mdi-check",color:"primary"})):Ie("",!0)]),"item.edit":t(({item:a})=>[e(P,{icon:"mdi-pencil",variant:"text",color:"primary",onClick:s=>B(a)},null,8,["onClick"])]),"item.remove":t(({item:a})=>[e(P,{icon:"mdi-delete",variant:"text",color:"secondary",onClick:s=>F(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),e(H,{modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=a=>g.value=a),width:"300px"},{default:t(()=>[e(J,{rounded:"xl"},{default:t(()=>[e(Y,{icon:"mdi-alert-circle",color:"secondary",size:"50",class:"ma-auto mt-5"}),e(Q,null,{default:t(()=>[V("確定要刪除「"+Re(n(m).value.value)+"」嗎？ ",1),qe,V(" 此動作無法復原！")]),_:1}),e(W,null,{default:t(()=>[e(Z),e(P,{color:"primary",rounded:"",onClick:S},{default:t(()=>[V("取消")]),_:1}),e(P,{color:"secondary",rounded:"",onClick:ne},{default:t(()=>[V("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:b.value,"onUpdate:modelValue":l[10]||(l[10]=a=>b.value=a),persistent:"",width:"500px"},{default:t(()=>[e($e,{disabled:n(f),onSubmit:Se(n(ue),["prevent"])},{default:t(()=>[e(J,{rounded:"xl"},{default:t(()=>[e(_e,{class:"text-center mt-3 pb-0"},{default:t(()=>[V("編輯使用者")]),_:1}),e(Q,null,{default:t(()=>[e(T,{label:"帳號",variant:"outlined",density:"compact",class:"pb-3",minlength:"4",maxlength:"20",counter:"",modelValue:n(m).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>n(m).value.value=a),"error-messages":n(m).errorMessage.value},null,8,["modelValue","error-messages"]),e(T,{label:"信箱",variant:"outlined",density:"compact",type:"email",min:"0",class:"pb-3",modelValue:n(y).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>n(y).value.value=a),"error-messages":n(y).errorMessage.value},null,8,["modelValue","error-messages"]),e(Ee,{modelValue:n(k).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>n(k).value.value=a),"error-messages":n(k).errorMessage.value,inline:""},{default:t(()=>[e(ae,{label:"一般會員",value:0}),e(ae,{label:"管理員",value:1})]),_:1},8,["modelValue","error-messages"]),e(i,{modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=a=>I.value=a),rawModelValue:j.value,"onUpdate:rawModelValue":l[9]||(l[9]=a=>j.value=a),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:v},null,8,["modelValue","rawModelValue","error-text"])]),_:1}),e(W,null,{default:t(()=>[e(Z),e(P,{color:"secondary",rounded:"",disabled:n(f),onClick:R},{default:t(()=>[V("取消")]),_:1},8,["disabled"]),e(P,{color:"primary",rounded:"",type:"submit",loading:n(f)},{default:t(()=>[V("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])])}}};export{oa as default};

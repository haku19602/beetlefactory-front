import{X as P,x as l,a0 as A,a1 as B,a2 as C,c as r,a4 as a,ar as w,V as L,aa as u,ac as v,J as f,aq as S,a9 as D,ad as I}from"./index-7fe67b54.js";import{V as z}from"./VContainer-5a48f817.js";import{V as N}from"./VRow-4336aeea.js";import{V as _}from"./VCol-f74ed9fd.js";import{V as R}from"./VDataTable-d00e0996.js";import"./VSelect-429a9236.js";import"./VList-4c1275af.js";import"./VDivider-35d85a57.js";import"./VChip-63b82233.js";const T={style:{height:"100%"},class:"bg-back"},U=D("h2",{class:"text-center mt-5 text-primary"},"訂單列表",-1),H={__name:"OrdersView",setup(q){const{apiAuth:k}=I(),h=P(),d=l([]),p=l(10),i=l([{key:"createdAt",order:"desc"}]),m=l(1),V=[{title:"訂購人",sortable:!1,key:"user.avatar"},{title:"",sortable:!0,key:"user.account"},{title:"訂單編號",sortable:!1,key:"_id"},{title:"訂購日期",sortable:!0,key:"createdAt"},{title:"訂單金額",key:"price",align:"center",value:s=>{const t=s.cart.reduce((n,e)=>n+e.quantity*e.product.price,0);return s.delivery==="黑貓"?t+110:s.delivery==="7-11 交貨便"?t+70:t}},{title:"付款狀態",sortable:!0,key:"paid",align:"center"},{title:"完成訂單",sortable:!0,key:"done",align:"center"}],g=l(!0),y=l(0),b=l(""),c=async()=>{var s,t,n,e;g.value=!0;try{const{data:o}=await k.get("/orders/all",{params:{page:m.value,itemsPerPage:p.value,sortBy:((s=i.value[0])==null?void 0:s.key)||"createdAt",sortOrder:((t=i.value[0])==null?void 0:t.order)==="asc"?1:-1,search:b.value}});d.value.splice(0,d.value.length,...o.result.data),y.value=o.result.total}catch(o){const x=((e=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";h({text:x,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}g.value=!1};return c(),(s,t)=>{const n=A("RouterLink");return B(),C("div",T,[r(z,null,{default:a(()=>[r(N,{class:"justify-center"},{default:a(()=>[r(_,{cols:"12",lg:"10"},{default:a(()=>[U]),_:1}),r(_,{cols:"12",lg:"10"},{default:a(()=>[r(R,{items:d.value,headers:V,"items-per-page":p.value,"onUpdate:itemsPerPage":[t[0]||(t[0]=e=>p.value=e),c],"sort-by":i.value,"onUpdate:sortBy":[t[1]||(t[1]=e=>i.value=e),c],page:m.value,"onUpdate:page":[t[2]||(t[2]=e=>m.value=e),c],search:b.value,"items-length":y.value,loading:g.value,class:"py-5 px-10 bg-back"},{"item.user.avatar":a(({item:e})=>[r(w,{size:"35"},{default:a(()=>[r(L,{src:e.user.avatar,contain:""},null,8,["src"])]),_:2},1024)]),"item._id":a(({item:e})=>[r(n,{to:"/orders/"+e._id,class:"text-primary"},{default:a(()=>[u(v(e._id.toString()),1)]),_:2},1032,["to"])]),"item.createdAt":a(({item:e})=>[u(v(new Date(e.createdAt).toLocaleString("zh-TW",{hour12:!1,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})),1)]),"item.paid":a(({item:e})=>[r(f,{variant:"outlined",rounded:"",class:S(e.paid?["text-primary"]:["text-error"]),onClick:o=>s.openPaidDialog(e)},{default:a(()=>[u(v(e.paid?"付款確認":"尚未付款"),1)]),_:2},1032,["class","onClick"])]),"item.done":a(({item:e})=>[r(f,{color:"primary",variant:"flat",rounded:"",disabled:e.done||!e.paid},{default:a(()=>[u(" 完成訂單 ")]),_:2},1032,["disabled"])]),_:2},1032,["items","items-per-page","sort-by","page","search","items-length","loading"])]),_:1})]),_:1})]),_:1})])}}};export{H as default};

import{p as Ve,aA as ye,aB as Fe,g as xe,D as be,aC as ke,aD as Be,o as W,u as he,aE as we,aF as Z,c as t,G as X,aG as Se,aH as Re,x as i,s as Ie,H as _e,A as Ae,z as Q,B as Me,aI as Ue,aJ as De,a6 as ee,T as ne,aK as Te,aL as Ne,aM as $e,aN as ze,ao as ae,aO as He,v as Ee,y as Ge,X as Le,a0 as re,a1 as ue,a2 as je,a4 as s,aP as ie,ad as qe,J as T,aa as N,ak as Y,aQ as Oe,V as Ke,a9 as Ce,ac as te,a3 as Je,a5 as Qe,ag as ce,W as de,ai as me,a8 as r,an as ve,ab as fe,aj as We,ah as Xe}from"./index-56665f09.js";import{c as Ye,a as le,e as ge,f as Ze,u as ea,d as O}from"./index.esm-d9932591.js";import{V as aa}from"./VContainer-3643fca0.js";import{a as ta,V as oe}from"./VRow-17d1423b.js";import{V as la}from"./VDataTableServer-c04dec8b.js";import{V as oa}from"./VForm-2981e2ee.js";import{m as sa,a as pe,V as na}from"./VSelect-fe8ae793.js";import"./VDivider-ed5f6064.js";import"./VList-82065880.js";import"./VChip-c04ce96e.js";const ra=Ve({...ye(),...Fe(sa(),["inline"])},"VCheckbox"),ua=xe()({name:"VCheckbox",inheritAttrs:!1,props:ra(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,P){let{attrs:y,slots:F}=P;const u=be(e,"modelValue"),{isFocused:c,focus:d,blur:$}=ke(e),z=Be(),H=W(()=>e.id||`checkbox-${z}`);return he(()=>{const[K,E]=we(y),G=Z.filterProps(e),B=pe.filterProps(e);return t(Z,X({class:["v-checkbox",e.class]},K,G,{modelValue:u.value,"onUpdate:modelValue":h=>u.value=h,id:H.value,focused:c.value,style:e.style}),{...F,default:h=>{let{id:S,messagesId:w,isDisabled:C,isReadonly:R}=h;return t(pe,X(B,{id:S.value,"aria-describedby":w.value,disabled:C.value,readonly:R.value},E,{modelValue:u.value,"onUpdate:modelValue":I=>u.value=I,onFocus:d,onBlur:$}),F)}})}),{}}});const ia=Ve({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ye(),...Se()},"VTextarea"),ca=xe()({name:"VTextarea",directives:{Intersect:Re},inheritAttrs:!1,props:ia(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,P){let{attrs:y,emit:F,slots:u}=P;const c=be(e,"modelValue"),{isFocused:d,focus:$,blur:z}=ke(e),H=W(()=>typeof e.counterValue=="function"?e.counterValue(c.value):(c.value||"").toString().length),K=W(()=>{if(y.maxlength)return y.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function E(o,v){var m,x;!e.autofocus||!o||(x=(m=v[0].target)==null?void 0:m.focus)==null||x.call(m)}const G=i(),B=i(),h=Ie(""),S=i(),w=W(()=>e.persistentPlaceholder||d.value||e.active);function C(){var o;S.value!==document.activeElement&&((o=S.value)==null||o.focus()),d.value||$()}function R(o){C(),F("click:control",o)}function I(o){F("mousedown:control",o)}function L(o){o.stopPropagation(),C(),ae(()=>{c.value="",He(e["onClick:clear"],o)})}function j(o){var m;const v=o.target;if(c.value=v.value,(m=e.modelModifiers)!=null&&m.trim){const x=[v.selectionStart,v.selectionEnd];ae(()=>{v.selectionStart=x[0],v.selectionEnd=x[1]})}}const p=i(),D=i(+e.rows),J=W(()=>["plain","underlined"].includes(e.variant));_e(()=>{e.autoGrow||(D.value=+e.rows)});function _(){e.autoGrow&&ae(()=>{if(!p.value||!B.value)return;const o=getComputedStyle(p.value),v=getComputedStyle(B.value.$el),m=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),x=p.value.scrollHeight,A=parseFloat(o.lineHeight),q=Math.max(parseFloat(e.rows)*A+m,parseFloat(v.getPropertyValue("--v-input-control-height"))),M=parseFloat(e.maxRows)*A+m||1/0,f=Ge(x??0,q,M);D.value=Math.floor((f-m)/A),h.value=Ee(f)})}Ae(_),Q(c,_),Q(()=>e.rows,_),Q(()=>e.maxRows,_),Q(()=>e.density,_);let V;return Q(p,o=>{o?(V=new ResizeObserver(_),V.observe(p.value)):V==null||V.disconnect()}),Me(()=>{V==null||V.disconnect()}),he(()=>{const o=!!(u.counter||e.counter||e.counterValue),v=!!(o||u.details),[m,x]=we(y),{modelValue:A,...q}=Z.filterProps(e),M=Ue(e);return t(Z,X({ref:G,modelValue:c.value,"onUpdate:modelValue":f=>c.value=f,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":J.value},e.class],style:e.style},m,q,{centerAffix:D.value===1&&!J.value,focused:d.value}),{...u,default:f=>{let{id:U,isDisabled:n,isDirty:l,isReadonly:g,isValid:b}=f;return t(De,X({ref:B,style:{"--v-textarea-control-height":h.value},onClick:R,onMousedown:I,"onClick:clear":L,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},M,{id:U.value,active:w.value||l.value,centerAffix:D.value===1&&!J.value,dirty:l.value||e.dirty,disabled:n.value,focused:d.value,error:b.value===!1}),{...u,default:a=>{let{props:{class:k,...se}}=a;return t(ee,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ne(t("textarea",X({ref:S,class:k,value:c.value,onInput:j,autofocus:e.autofocus,readonly:g.value,disabled:n.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:C,onBlur:z},se,x),null),[[Te("intersect"),{handler:E},null,{once:!0}]]),e.autoGrow&&ne(t("textarea",{class:[k,"v-textarea__sizer"],id:`${se.id}-sizer`,"onUpdate:modelValue":Pe=>c.value=Pe,ref:p,readonly:!0,"aria-hidden":"true"},null),[[Ne,c.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?f=>{var U;return t(ee,null,[(U=u.details)==null?void 0:U.call(u,f),o&&t(ee,null,[t("span",null,null),t($e,{active:e.persistentCounter||d.value,value:H.value,max:K.value},u.counter)])])}:void 0})}),ze({},G,B,S)}}),da={style:{height:"100%"},class:"bg-back"},ma=Ce("h2",{class:"text-center mt-5 text-primary"},"商品列表",-1),va={class:"text-grey-darken-3 font-weight-bold"},Ca={__name:"ProductsView",setup(e){const{apiAuth:P}=qe(),y=Le(),F=i(null),u=i(!1),c=i(!1),d=i(""),$=["成蟲","幼蟲","標本","其他"],z=n=>{n?(d.value=n._id,w.value.value=n.name,C.value.value=n.price,R.value.value=n.stock,I.value.value=n.description,L.value.value=n.category,j.value.value=n.sell):d.value="",u.value=!0},H=()=>{u.value=!1,S(),F.value.deleteFileRecord()},K=n=>{d.value=n._id,w.value.value=n.name,c.value=!0},E=()=>{c.value=!1},G=Ye({name:le().required("缺少商品名稱"),price:ge().typeError("價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),stock:ge().typeError("數量格式錯誤").required("缺少商品數量").min(0,"商品數量不能小於 0"),description:le().required("缺少商品描述"),category:le().required("缺少商品分類").test("isCategory","商品分類錯誤",n=>$.includes(n)),sell:Ze()}),{handleSubmit:B,isSubmitting:h,resetForm:S}=ea({validationSchema:G,initialValues:{name:"",price:0,stock:0,description:"",category:"",sell:!1}}),w=O("name"),C=O("price"),R=O("stock"),I=O("description"),L=O("category"),j=O("sell"),p=i([]),D=i([]),J=async()=>{var n,l;try{await P.delete("/products/"+d.value),y({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),E(),f()}catch(g){console.log(g);const b=((l=(n=g==null?void 0:g.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";y({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},_=B(async n=>{var l,g,b;if(!((l=p.value[0])!=null&&l.error)&&!(d.value===""&&p.value.length===0))try{const a=new FormData;for(const k in n)a.append(k,n[k]);p.value.length>0&&a.append("image",p.value[0].file),d.value===""?await P.post("/products",a):await P.patch("/products/"+d.value,a),y({text:d.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),H(),U()}catch(a){console.log(a);const k=((b=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:b.message)||"發生錯誤，請稍後再試";y({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}}),V=i(10),o=i([{key:"createdAt",order:"desc"}]),v=i(1),m=i([]),x=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"品名",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"庫存",align:"center",sortable:!0,key:"stock"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],A=i(!0),q=i(0),M=i(""),f=async()=>{var n,l,g,b;A.value=!0;try{const{data:a}=await P.get("/products/all",{params:{page:v.value,itemsPerPage:V.value,sortBy:((n=o.value[0])==null?void 0:n.key)||"createdAt",sortOrder:((l=o.value[0])==null?void 0:l.order)==="asc"?1:-1,search:M.value}});m.value.splice(0,m.value.length,...a.result.data),q.value=a.result.total}catch(a){console.log(a);const k=((b=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:b.message)||"發生錯誤，請稍後再試";y({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}A.value=!1};f();const U=()=>{v.value=1,f()};return(n,l)=>{const g=re("RouterLink"),b=re("VueFileAgent");return ue(),je("div",da,[t(aa,null,{default:s(()=>[t(ta,{class:"justify-center"},{default:s(()=>[t(oe,{cols:"10"},{default:s(()=>[ma]),_:1}),t(oe,{cols:"10",class:"text-end"},{default:s(()=>[t(T,{"prepend-icon":"mdi-plus",color:"primary",rounded:"",onClick:l[0]||(l[0]=a=>z())},{default:s(()=>[N("新增商品")]),_:1})]),_:1}),t(oe,{cols:"10",class:"mx-auto"},{default:s(()=>[t(la,{"items-per-page":V.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>V.value=a),f],"sort-by":o.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>o.value=a),f],page:v.value,"onUpdate:page":[l[4]||(l[4]=a=>v.value=a),f],items:m.value,headers:x,loading:A.value,"items-length":q.value,search:M.value,class:"py-5 px-10 bg-back"},{top:s(()=>[t(Y,{label:"搜尋","append-inner-icon":"mdi-magnify",modelValue:M.value,"onUpdate:modelValue":l[1]||(l[1]=a=>M.value=a),variant:"underlined","onClick:appendInner":U,onKeydown:Oe(U,["enter"])},null,8,["modelValue"])]),"item.image":s(({item:a})=>[t(g,{to:"/products/"+a._id},{default:s(()=>[t(Ke,{src:a.image,height:"100px",contain:""},null,8,["src"])]),_:2},1032,["to"])]),"item.name":s(({item:a})=>[t(g,{to:"/products/"+a._id,class:"text-decoration-none"},{default:s(()=>[Ce("p",va,te(a.name),1)]),_:2},1032,["to"])]),"item.sell":s(({item:a})=>[a.sell?(ue(),Je(de,{key:0,icon:"mdi-check",color:"primary"})):Qe("",!0)]),"item.edit":s(({item:a})=>[t(T,{icon:"mdi-pencil",variant:"text",color:"primary",onClick:k=>z(a)},null,8,["onClick"])]),"item.remove":s(({item:a})=>[t(T,{icon:"mdi-delete",variant:"text",color:"secondary",onClick:k=>K(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(ie,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=a=>c.value=a),width:"300px"},{default:s(()=>[t(ce,{rounded:"xl"},{default:s(()=>[t(de,{icon:"mdi-alert-circle",color:"secondary",size:"50",class:"ma-auto mt-5"}),t(me,null,{default:s(()=>[N("確定要刪除「"+te(r(w).value.value)+"」嗎？此動作無法復原！",1)]),_:1}),t(ve,null,{default:s(()=>[t(fe),t(T,{color:"primary",rounded:"",onClick:E},{default:s(()=>[N("取消")]),_:1}),t(T,{color:"secondary",rounded:"",onClick:J},{default:s(()=>[N("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:u.value,"onUpdate:modelValue":l[14]||(l[14]=a=>u.value=a),persistent:"",width:"500px"},{default:s(()=>[t(oa,{disabled:r(h),onSubmit:We(r(_),["prevent"])},{default:s(()=>[t(ce,{rounded:"xl"},{default:s(()=>[t(Xe,{class:"text-center mt-3 pb-0"},{default:s(()=>[N(te(d.value===""?"新增商品":"編輯商品"),1)]),_:1}),t(me,null,{default:s(()=>[t(Y,{label:"商品名稱",variant:"outlined",density:"compact",class:"pb-3",modelValue:r(w).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>r(w).value.value=a),"error-messages":r(w).errorMessage.value},null,8,["modelValue","error-messages"]),t(Y,{label:"價格",variant:"outlined",density:"compact",type:"number",min:"0",class:"pb-3",modelValue:r(C).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>r(C).value.value=a),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"]),t(Y,{label:"商品數量",variant:"outlined",density:"compact",type:"number",min:"0",class:"pb-3",modelValue:r(R).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>r(R).value.value=a),"error-messages":r(R).errorMessage.value},null,8,["modelValue","error-messages"]),t(na,{label:"分類",variant:"outlined",density:"compact",items:$,modelValue:r(L).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>r(L).value.value=a),"error-messages":r(L).errorMessage.value},null,8,["modelValue","error-messages"]),t(ua,{label:"上架",density:"compact",modelValue:r(j).value.value,"onUpdate:modelValue":l[10]||(l[10]=a=>r(j).value.value=a),"error-messages":r(j).errorMessage.value},null,8,["modelValue","error-messages"]),t(ca,{label:"商品描述",variant:"outlined",density:"compact",modelValue:r(I).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>r(I).value.value=a),"error-messages":r(I).errorMessage.value},null,8,["modelValue","error-messages"]),t(b,{modelValue:p.value,"onUpdate:modelValue":l[12]||(l[12]=a=>p.value=a),rawModelValue:D.value,"onUpdate:rawModelValue":l[13]||(l[13]=a=>D.value=a),accept:"image/jpeg,image/png","max-size":"2MB","error-text":{type:"檔案格式不支援，只接受 .jpeg .png",size:"檔案超過 2MB 大小限制"},deletable:"","help-text":"選擇商品圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:F},null,8,["modelValue","rawModelValue","error-text"])]),_:1}),t(ve,null,{default:s(()=>[t(fe),t(T,{color:"secondary",rounded:"",disabled:r(h),onClick:H},{default:s(()=>[N("取消")]),_:1},8,["disabled"]),t(T,{color:"primary",rounded:"",type:"submit",loading:r(h)},{default:s(()=>[N("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])])}}};export{Ca as default};

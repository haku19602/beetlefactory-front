import{_ as E,ap as N,Y as j,X as F,Z as L,x as M,o as $,A,a1 as d,a2 as R,c as o,a4 as l,al as D,ad as U,V as z,a9 as n,ac as v,aa as p,a8 as i,aj as J,ak as O,a3 as _,J as m,a5 as V,ae as X,af as Y}from"./index-fe19f0ca.js";import{c as Z,e as G,u as H,d as K}from"./index.esm-75097ff2.js";import{V as Q}from"./VContainer-e3da55f4.js";import{a as W,V as w}from"./VRow-701fd95c.js";import{V as ee}from"./VChip-fbf9c447.js";import{V as te}from"./VForm-cc1911fe.js";import{V as ae}from"./VDivider-b487ddc4.js";const C=h=>(X("data-v-17663df3"),h=h(),Y(),h),se={style:{height:"100%"},class:"bg-back"},oe={class:"d-flex justify-space-between text-primary"},le={class:"text-end"},ce=C(()=>n("h4",{class:"text-primary"},"商品描述",-1)),re={style:{"white-space":"pre"}},ie=C(()=>n("h1",{class:"text-back text-h2 font-weight-black mb-5"},"已下架",-1)),ne={__name:"ProductEach",setup(h){const S=N(),y=j(),{api:B,apiAuth:k}=U(),u=F(),r=L(),t=M({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:"",stock:0,stockText:""}),x=$(()=>r.likes.includes(t.value._id)),P=Z({quantity:G().typeError("數量格式錯誤").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:g,handleSubmit:q}=H({validationSchema:P,initialValues:{quantity:1}}),f=K("quantity"),I=q(async c=>{var a,e;if(!r.isLogin){y.push("/login");return}try{const{data:s}=await k.patch("/users/cart",{product:t.value._id,quantity:c.quantity});r.cart=s.result,u({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"back",location:"center"}})}catch(s){const T=((e=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";u({text:T,showCloseButton:!1,snackbarProps:{timeout:1e3,color:"secondary",location:"center"}})}}),b=async()=>{var c,a;if(!r.isLogin){y.push("/login");return}try{await k.patch("/users/likes",{product:t.value._id});const e=r.likes.findIndex(s=>s===t.value._id);e>-1?r.likes.splice(e,1):r.likes.push(t.value._id),u({text:x.value?"已加入收藏！":"已取消收藏！",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"back",location:"center"}})}catch(e){console.log(e);const s=((a=(c=e==null?void 0:e.response)==null?void 0:c.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";u({text:s,showCloseButton:!1,snackbarProps:{timeout:1e3,color:"secondary",location:"center"}})}};return A(async()=>{var c,a;try{const{data:e}=await B.get("/products/"+S.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,t.value.stock=e.result.stock,e.result.stock<=5&&e.result.stock>0&&(t.value.stockText=`最後 ${e.result.stock} 組！`),document.title=`甲蟲工廠 | ${t.value.name}`}catch(e){const s=((a=(c=e==null?void 0:e.response)==null?void 0:c.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";u({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}}),y.push("/shop")}}),(c,a)=>(d(),R("div",se,[o(Q,{class:"pt-12"},{default:l(()=>[o(W,{class:"justify-center"},{default:l(()=>[o(w,{cols:"10",lg:"5"},{default:l(()=>[o(z,{src:t.value.image,rounded:"xl","max-width":"500px",class:"mx-auto"},null,8,["src"])]),_:1}),o(w,{cols:"10",lg:"5",class:"pt-16 px-10"},{default:l(()=>[n("h2",null,v(t.value.name),1),n("h3",oe,[p(" NT. "+v(t.value.price),1),o(ee,{variant:"outlined",color:"primary"},{default:l(()=>[p(v(t.value.category),1)]),_:1})]),o(te,{disabled:i(g),onSubmit:J(i(I),["prevent"]),class:"d-flex mt-5"},{default:l(()=>[o(O,{type:"number",placeholder:"數量",min:"0",max:t.value.stock,color:"primary",variant:"outlined",density:"comfortable",disabled:t.value.stock===0,modelValue:i(f).value.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i(f).value.value=e),modelModifiers:{number:!0},"error-messages":i(f).errorMessage.value,hint:t.value.stockText,"persistent-hint":"",class:"hint-color"},null,8,["max","disabled","modelValue","error-messages","hint"]),t.value.stock>0?(d(),_(m,{key:0,type:"submit","prepend-icon":"mdi-cart",color:"primary",width:"50%",height:"48px",class:"ms-3",loading:i(g)},{default:l(()=>[p("加入購物車")]),_:1},8,["loading"])):V("",!0),t.value.stock===0?(d(),_(m,{key:1,"prepend-icon":"mdi-cart",color:"grey-darken-1",width:"50%",height:"48px",class:"ms-3",disabled:t.value.stock===0},{default:l(()=>[p("已售完")]),_:1},8,["disabled"])):V("",!0)]),_:1},8,["disabled","onSubmit"]),n("div",le,[x.value?(d(),_(m,{key:0,icon:"mdi-heart",color:"secondary",variant:"text",density:"comfortable",onClick:b,class:"text-center"})):(d(),_(m,{key:1,icon:"mdi-heart-outline",color:"secondary",variant:"text",density:"comfortable",onClick:b,class:"text-center"}))]),ce,o(ae,{class:"my-2"}),n("p",re,v(t.value.description),1)]),_:1})]),_:1})]),_:1}),o(D,{"model-value":!t.value.sell,persistent:"",class:"align-center justify-center text-center",opacity:"0.5"},{default:l(()=>[ie,o(m,{to:"/",color:"primary",size:"x-large",elevation:"15",rounded:""},{default:l(()=>[p("回首頁")]),_:1})]),_:1},8,["model-value"])]))}},ye=E(ne,[["__scopeId","data-v-17663df3"]]);export{ye as default};
